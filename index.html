<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Utawala Birthday Wall ğŸ‚</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>

<!-- Confetti -->
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
body{
  font-family: Arial;
  margin:0;
  padding:20px;
  background:linear-gradient(135deg,#ff9a9e,#fad0c4);
  text-align:center;
}
h1{color:white;}
.box{
  background:white;
  padding:20px;
  border-radius:15px;
  max-width:450px;
  margin:20px auto;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}
input,textarea,select{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:8px;
  border:1px solid #ccc;
}
button{
  padding:10px;
  border:none;
  border-radius:8px;
  background:#ff4081;
  color:white;
  cursor:pointer;
  margin-top:5px;
}
button:hover{background:#e73370;}
.wall{
  display:grid;
  gap:15px;
  margin-top:20px;
}
.card{
  background:white;
  padding:15px;
  border-radius:15px;
  box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
.premium{
  border:3px solid gold;
  box-shadow:0 0 20px gold;
}
.featured{
  background:gold;
  padding:15px;
  border-radius:15px;
  margin-bottom:20px;
}
.hidden{display:none;}
.admin{background:black;}
.analytics{
  background:#222;
  color:white;
  padding:15px;
  border-radius:12px;
  margin-top:15px;
}
.countdown{
  font-size:18px;
  font-weight:bold;
  color:#ff4081;
  margin-top:10px;
}
</style>
</head>
<body>

<h1>ğŸ‚ Utawala Birthday Wall ğŸ‚</h1>

<div id="featured"></div>
<div id="countdown" class="countdown"></div>

<div class="box">
<h3>Post Birthday Message</h3>
<input id="from" placeholder="From">
<input id="to" placeholder="To">
<input type="date" id="birthdayDate">
<textarea id="message" placeholder="Message"></textarea>
<input type="file" id="imageFile">
<select id="premium">
<option value="No">Normal (KES 200)</option>
<option value="Yes">Premium (KES 500)</option>
</select>
<button onclick="submitMsg()">Submit (Approval Required)</button>
<button class="admin" onclick="adminLogin()">Admin Panel</button>
</div>

<div class="box hidden" id="adminPanel">
<h3>Admin Dashboard</h3>
<div id="analytics" class="analytics"></div>
<div id="pending"></div>
</div>

<div class="wall" id="wall"></div>

<script>

/* ğŸ”¥ REPLACE WITH YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyCPG6MTfF49v7-MYZKzgQm-aS8HARRdIU0",
  authDomain: "utawalabirthdaywall.firebaseapp.com",
  databaseURL: "https://utawalabirthdaywall-default-rtdb.firebaseio.com",
  projectId: "utawalabirthdaywall",
  storageBucket: "utawalabirthdaywall.firebasestorage.app",
  messagingSenderId: "488490311718",
  appId: "1:488490311718:web:8d9acf2eac76ed5ea306e7"
};
  
// Initialize Firebase
const app = initializeApp(firebaseConfig);
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();
const ref = db.ref("birthdayMessages");

let ADMIN_PASSWORD = "1234"; // Change this!
let lastApprovedCount = 0;

/* Submit Message */
async function submitMsg(){
  const from=document.getElementById("from").value;
  const to=document.getElementById("to").value;
  const message=document.getElementById("message").value;
  const premium=document.getElementById("premium").value;
  const birthdayDate=document.getElementById("birthdayDate").value;
  const file=document.getElementById("imageFile").files[0];

  if(!from||!to||!message){
    alert("Fill required fields");
    return;
  }

  let imageURL="";
  if(file){
    const storageRef=storage.ref("images/"+Date.now()+"_"+file.name);
    await storageRef.put(file);
    imageURL=await storageRef.getDownloadURL();
  }

  let price=premium==="Yes"?500:200;

  ref.push({
    from,
    to,
    message,
    imageURL,
    premium,
    birthdayDate,
    paid:false,
    price,
    timestamp:Date.now()
  });

  alert("Submitted for approval!");
}

/* Load Data */
ref.on("value",snap=>{
  const wall=document.getElementById("wall");
  const pending=document.getElementById("pending");
  const featured=document.getElementById("featured");
  const analytics=document.getElementById("analytics");

  wall.innerHTML="";
  pending.innerHTML="";
  featured.innerHTML="";

  let total=0, approved=0, pendingCount=0, premiumCount=0;
  let now=Date.now();

  snap.forEach(child=>{
    const data=child.val();
    const id=child.key;

    /* Auto Expire After 7 Days */
    if(data.paid && now-data.timestamp>7*24*60*60*1000){
      ref.child(id).remove();
      return;
    }

    if(data.paid){
      approved++;
      total+=data.price;
      if(data.premium==="Yes") premiumCount++;
    }

    /* Approved Posts */
    if(data.paid===true){
      const card=document.createElement("div");
      card.className="card";
      if(data.premium==="Yes") card.classList.add("premium");

      card.innerHTML=`
      <h3>ğŸ‰ ${data.from} â†’ ${data.to}</h3>
      <p>${data.message}</p>
      ${data.imageURL?`<img src="${data.imageURL}" width="100%">`:""}
      `;

      wall.appendChild(card);

      if(data.birthdayDate){
        startCountdown(data.birthdayDate);
      }

      if(data.premium==="Yes"){
        const f=document.createElement("div");
        f.className="featured";
        f.innerHTML=`ğŸ‘‘ PREMIUM: ${data.from} â†’ ${data.to}<br>${data.message}`;
        featured.appendChild(f);
      }
    }

    /* Pending */
    if(data.paid===false){
      pendingCount++;
      pending.innerHTML+=`
      <strong>${data.from} â†’ ${data.to}</strong><br>
      <button onclick="approve('${id}')">Approve</button>
      <button onclick="del('${id}')">Delete</button>
      <hr>
      `;
    }

  });

  if(approved>lastApprovedCount){
    confetti({particleCount:100,spread:70});
  }
  lastApprovedCount=approved;

  analytics.innerHTML=`
  ğŸ’° Earnings: KES ${total}<br>
  âœ… Approved: ${approved}<br>
  â³ Pending: ${pendingCount}<br>
  ğŸ‘‘ Premium Posts: ${premiumCount}
  `;
});

/* Countdown */
function startCountdown(date){
  const countdown=document.getElementById("countdown");
  const target=new Date(date).getTime();
  setInterval(()=>{
    const now=Date.now();
    const diff=target-now;
    if(diff>0){
      const days=Math.floor(diff/(1000*60*60*24));
      countdown.innerHTML=`ğŸ‚ Birthday in ${days} days`;
    }
  },1000);
}

/* Approve/Delete */
function approve(id){ref.child(id).update({paid:true});}
function del(id){ref.child(id).remove();}

/* Admin Login */
function adminLogin(){
  let pass=prompt("Enter Admin Password:");
  if(pass===ADMIN_PASSWORD){
    document.getElementById("adminPanel").classList.remove("hidden");
  }else{
    alert("Wrong password");
  }
}

</script>

</body>
</html>
